<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.zfy.yuio.dao.StatsStatusDao">
    <select id="getCityInfo" parameterType="QueryParams" resultType="StatsEmplResult">
        SELECT COUNT( s.student_code ) AS total_people,ci.city_name
        FROM sys_student s
        LEFT JOIN sys_class cls ON s.student_class_id = cls.class_id
        LEFT JOIN sys_major m ON cls.class_major_id = m.major_id
        LEFT JOIN sys_college c ON m.major_college_id = c.college_id
        LEFT JOIN write_empl_info ei ON ei.empl_student_code = s.student_code
        LEFT JOIN sys_city ci ON ei.empl_city_id = ci.city_id
        WHERE 1 = 1
        <if test="orgId!=null">
            AND (
            cls.class_id=#{orgId}
            OR m.major_id=#{orgId}
            OR c.college_id=#{orgId}
            )
        </if>
        <if test="grade!=0">
            AND cls.class_grade=#{grade}
        </if>
        <if test="emplStatus!=null">
            AND ei.empl_status=#{emplStatus}
        </if>
        GROUP BY ci.city_name
    </select>

    <select id="getWorkInfo" parameterType="QueryParams" resultType="StatsEmplResult">
        SELECT COUNT( s.student_code ) AS total_people,w.work_name,w.work_pid
        FROM sys_student s
        LEFT JOIN sys_class cls ON s.student_class_id = cls.class_id
        LEFT JOIN sys_major m ON cls.class_major_id = m.major_id
        LEFT JOIN sys_college c ON m.major_college_id = c.college_id
        LEFT JOIN write_empl_info ei ON ei.empl_student_code = s.student_code
        LEFT JOIN sys_work w ON ei.empl_work_id = w.work_id
        WHERE 1 = 1
        <if test="orgId!=null">
            AND (
            cls.class_id=#{orgId}
            OR m.major_id=#{orgId}
            OR c.college_id=#{orgId}
            )
        </if>
        <if test="grade!=0">
            AND cls.class_grade=#{grade}
        </if>
        <if test="emplStatus!=null">
            AND ei.empl_status=#{emplStatus}
        </if>
        GROUP BY w.work_name
    </select>

    <select id="getStudentPlan" parameterType="QueryParams" resultType="StatsEmplResult">
        SELECT COUNT( s.student_code ) AS total_people,ei.empl_plan
        FROM sys_student s
        LEFT JOIN sys_class cls ON s.student_class_id = cls.class_id
        LEFT JOIN sys_major m ON cls.class_major_id = m.major_id
        LEFT JOIN sys_college c ON m.major_college_id = c.college_id
        LEFT JOIN write_empl_info ei ON ei.empl_student_code = s.student_code
        WHERE 1 = 1
        <if test="orgId!=null">
            AND (
            cls.class_id=#{orgId}
            OR m.major_id=#{orgId}
            OR c.college_id=#{orgId}
            )
        </if>
        <if test="grade!=0">
            AND cls.class_grade=#{grade}
        </if>
        <if test="emplStatus!=null">
            AND ei.empl_status=#{emplStatus}
        </if>
        GROUP BY ei.empl_plan
    </select>

    <select id="getWorkRank" parameterType="QueryParams" resultType="StatsEmplResult">
		SELECT COUNT( s.student_code ) AS total_people,w.work_name
		FROM sys_student s
		LEFT JOIN sys_class cls ON s.student_class_id = cls.class_id
		LEFT JOIN sys_major m ON cls.class_major_id = m.major_id
		LEFT JOIN sys_college c ON m.major_college_id = c.college_id
		LEFT JOIN write_empl_info ei ON ei.empl_student_code = s.student_code
		LEFT JOIN sys_work w ON ei.empl_work_id = w.work_id
        WHERE 1 = 1
        <if test="orgId!=null">
            AND (
            cls.class_id=#{orgId}
            OR m.major_id=#{orgId}
            OR c.college_id=#{orgId}
            )
        </if>
        <if test="grade!=0">
            AND cls.class_grade=#{grade}
        </if>
        <if test="emplStatus!=null">
            AND ei.empl_status=#{emplStatus}
        </if>
        <if test="gender!=null">
            AND s.student_gender=#{gender}
        </if>
        GROUP BY w.work_name
        ORDER BY total_people DESC
    </select>

    <select id="getPlanRank" parameterType="QueryParams" resultType="StatsEmplResult">
        SELECT COUNT( s.student_code ) AS total_people,ei.empl_plan
        FROM sys_student s
        LEFT JOIN sys_class cls ON s.student_class_id = cls.class_id
        LEFT JOIN sys_major m ON cls.class_major_id = m.major_id
        LEFT JOIN sys_college c ON m.major_college_id = c.college_id
        LEFT JOIN write_empl_info ei ON ei.empl_student_code = s.student_code
        WHERE 1 = 1
        <if test="orgId!=null">
            AND (
            cls.class_id=#{orgId}
            OR m.major_id=#{orgId}
            OR c.college_id=#{orgId}
            )
        </if>
        <if test="grade!=0">
            AND cls.class_grade=#{grade}
        </if>
        <if test="emplStatus!=null">
            AND ei.empl_status=#{emplStatus}
        </if>
        <if test="gender!=null">
            AND s.student_gender=#{gender}
        </if>
        GROUP BY ei.empl_plan
        ORDER BY total_people DESC
    </select>
</mapper>