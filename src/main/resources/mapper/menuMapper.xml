<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.zfy.yuio.dao.MenuDao">
    <insert id="add" parameterType="Menu">
        INSERT INTO menu(menu_id,menu_name,menu_mark,menu_url,menu_icon,menu_description,menu_status,menu_level,menu_pid,menu_type)
        VALUES(#{menuId},#{menuName},#{menuMark},#{menuUrl},#{menuIcon},#{menuDescription},#{menuStatus},#{menuLevel},#{menuPid},#{menuType})
    </insert>

    <select id="get" resultType="Menu">
        SELECT * FROM menu
    </select>

    <delete id="del" parameterType="String">
        DELETE FROM menu
        WHERE menu_id=#{id}
    </delete>

    <update id="upd" parameterType="Menu">
        UPDATE menu
        SET menu_name=#{menuName},menu_mark=#{menuMark},menu_url=#{menuUrl},menu_icon=#{menuIcon},menu_description=#{menuDescription},menu_status=#{menuStatus},menu_level=#{menuLevel},menu_pid=#{menuPid},menu_type=#{menuType}
        WHERE menu_id=#{menuId}
    </update>

    <select id="getUserPerms" parameterType="String" resultType="String">
        SELECT m.menu_mark FROM menu m
        LEFT JOIN role_perms_relation rp
        ON rp.rpr_perms_id=m.menu_id
        LEFT JOIN role r
        ON rp.rpr_role_id=r.role_id
        LEFT JOIN usr_role_relation ur
        ON ur.urr_role_id=r.role_id
        LEFT JOIN usr u
        ON ur.urr_usr_id=u.usr_id
        WHERE u.usr_id=#{id}
    </select>
</mapper>